<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Matrix</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Matrix</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/matrix_rb.html">
                app/models/matrix.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Matrix.html">Matrix</a> class encapsulates three related but
essentially different sparse matrices, and is very purpose-specific.
</p>
<h1>Goals</h1>
<ul>
<li>Sparse storage

</li>
<li>Multi-level tree structure for storing cross-validation training and test
sets.

</li>
</ul>
<h1>Usage</h1>
<h2>Entering <a href="Matrix.html">Matrix</a> Data</h2>
<p>
This is something I haven&#8216;t done in a while. I can&#8216;t remember
off the top of my head what the function is.
</p>
<p>
What I can tell you, though, is you need the tables in standard phenolog
format. You also need to keep in mind that not every gene has phenotypes
associated, so matrices need to have the empty <a
href="Matrix.html#M000093">rows</a> registered. There is no need to
register empty columns.
</p>
<h2>Cross-validation</h2>
<p>
Once you&#8216;ve entered matrix data (for a single matrix), if you want to
cross- validate, you need to create n child matrices which each contain 1/n
<a href="Matrix.html#M000093">rows</a>. (There is currently no way to do
cell-based cross-validation, as that would require a non-sparse matrix
format.)
</p>
<p>
Child matrices can be created using the <a
href="Matrix.html#M000131">fractalize</a> function, which takes as an
argument the number (or numbers) of folds you want. So, to do single-stage
cross-validation, you&#8216;d do:
</p>
<pre>
 matrix.fractalize 10
</pre>
<p>
To do two-stage five-fold cross-validation, you use:
</p>
<pre>
 matrix.fractalize [5,5]
</pre>
<p>
Don&#8216;t forget to save the parent matrix after the generation of
children is complete.
</p>
<p>
WARNING: <em>Do not run <a href="Matrix.html#M000131">fractalize</a> more
than once on a single matrix.</em> If you want to do multiple types of
cross-validation, you need to <a href="Matrix.html#M000086">copy</a> the
matrix and then save the <a href="Matrix.html#M000086">copy</a> &#8212; and
after that you can run <a href="Matrix.html#M000131">fractalize</a> on the
<a href="Matrix.html#M000086">copy</a>.
</p>
<h1>Design</h1>
<h2>Tree Structure</h2>
<ul>
<li>Matrices in tree (<a href="TreeMatrix.html">TreeMatrix</a>) are either
root/branch (<a href="NodeMatrix.html">NodeMatrix</a>) or leaf (<a
href="LeafMatrix.html">LeafMatrix</a>).

</li>
<li>Root/branch matrices are stored in their entirety.

</li>
<li>Leaf matrices are stored as masks of their parents (which are root/branch).

</li>
<li>The different levels can be divided in different folds (e.g., both
ten-fold, both five-fold, or one ten and one five, for example).

</li>
<li>Division of matrices is recursive, so you can have as many levels as you
want.

</li>
<li>If a matrix has no children or parents (i.e., it&#8216;s a singleton), it
is stored as a root/branch.

</li>
</ul>
<h2>Database Storage</h2>
<ul>
<li>Two classes of <a href="Entry.html">Entry</a> in the database: <a
href="Cell.html">Cell</a>, <a href="EmptyRow.html">EmptyRow</a> (children
of <a href="Entry.html">Entry</a>).

</li>
<li>Empty columns are not stored, as these are not required for
cross-validation.

</li>
<li>Empty <a href="Matrix.html#M000093">rows</a> mark genes which have no
phenotypes in an organism.

</li>
<li>An organism that lacks a gene will have no empty row.

</li>
<li>When a test set is generated from a root/branch matrix, and removal of
cells causes a row to become empty, an <a href="EmptyRow.html">EmptyRow</a>
is added to the test set matrix.

</li>
</ul>
<h2>Working Directory</h2>
<p>
Since matrix calculations occur outside of the Rails environment &#8212;
typically as binaries or scripts executed through the shell &#8212;
matrices must be output to the filesystem.
</p>
<p>
The function `<a href="Matrix.html#M000096">prepare_inputs</a>` is
responsible for initializing the working directory, which is in
`crossval/tmp/work`.
</p>
<p>
Each root/branch matrix has its own working directory in `tmp/work`, with
the directory name consisting of &#8216;matrix_&#8217; followed by the
unique ID for the matrix. For example, the Human non-random matrix is
`tmp/work/matrix_1/`.
</p>
<p>
The matrix directory includes, at a bare minimum:
</p>
<ul>
<li>`genes.Sp`, a list of the unique <a href="Matrix.html#M000093">rows</a> in
the matrix (typically by Entrez human gene ID)

</li>
<li>`genes_phenes.Sp`, a list of the cells in the matrix. The format of this
matrix is one line per cell, with the row (gene ID) in the first table
column and the column (phenotype ID) in the second table column.

</li>
</ul>
<p>
Note that Sp represents the species abbreviation, e.g., &#8216;Hs&#8217;.
If the matrix is a randomization, the suffix will be Spr, e.g.,
&#8216;Hsr&#8217;.
</p>
<p>
In addition, if test sets have been generated for the matrix, these will be
given by the identifier `testset.`; followed by the number of children
(immediate descendents) the matrix has; a dash; and the number of this
particular test set (starting at 0). For example, matrix 1 has
`testset.10-0` through `testset.10-9`. Each test set is formatted in the
same way as `genes_phenes.Sp`.
</p>
<h2>Subdirectories</h2>
<p>
Each matrix working directory may contain multiple sub-directories which
function as working directories for experiments. These are named in the
same manner as matrix working directories, e.g., `experiment_1` for the <a
href="Experiment.html">Experiment</a> with database ID 1.
</p>
<p>
The contents of these directories are given in the docs for the <a
href="Experiment.html">Experiment</a> class (and its children as
appropriate).
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000094">all_rows</a>&nbsp;&nbsp;
      <a href="#M000101">cell_file_path</a>&nbsp;&nbsp;
      <a href="#M000100">cell_filename</a>&nbsp;&nbsp;
      <a href="#M000148">cells_by_row</a>&nbsp;&nbsp;
      <a href="#M000102">cells_for_display</a>&nbsp;&nbsp;
      <a href="#M000128">children_filenames</a>&nbsp;&nbsp;
      <a href="#M000104">children_have_been_run?</a>&nbsp;&nbsp;
      <a href="#M000092">column_indeces</a>&nbsp;&nbsp;
      <a href="#M000086">copy</a>&nbsp;&nbsp;
      <a href="#M000088">copy_and_randomize</a>&nbsp;&nbsp;
      <a href="#M000121">count_unique_columns</a>&nbsp;&nbsp;
      <a href="#M000122">count_unique_rows</a>&nbsp;&nbsp;
      <a href="#M000120">count_unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000118">count_unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000150">create_empty_row!</a>&nbsp;&nbsp;
      <a href="#M000108">create_from_file!</a>&nbsp;&nbsp;
      <a href="#M000106">create_from_file_pair!</a>&nbsp;&nbsp;
      <a href="#M000107">create_from_file_pairs!</a>&nbsp;&nbsp;
      <a href="#M000109">create_from_files!</a>&nbsp;&nbsp;
      <a href="#M000089">density</a>&nbsp;&nbsp;
      <a href="#M000085">destroy_borked</a>&nbsp;&nbsp;
      <a href="#M000136">dir_exists?</a>&nbsp;&nbsp;
      <a href="#M000149">find_or_create_cell!</a>&nbsp;&nbsp;
      <a href="#M000131">fractalize</a>&nbsp;&nbsp;
      <a href="#M000132">fractalize_by_method</a>&nbsp;&nbsp;
      <a href="#M000105">has_been_run?</a>&nbsp;&nbsp;
      <a href="#M000129">has_experiments_to_run?</a>&nbsp;&nbsp;
      <a href="#M000095">indeces_by_row_or_column</a>&nbsp;&nbsp;
      <a href="#M000126">is_phenomatrix?</a>&nbsp;&nbsp;
      <a href="#M000138">ls</a>&nbsp;&nbsp;
      <a href="#M000087">make_empty_copy</a>&nbsp;&nbsp;
      <a href="#M000133">make_inputs</a>&nbsp;&nbsp;
      <a href="#M000141">make_inputs_internal</a>&nbsp;&nbsp;
      <a href="#M000103">number_of_rows</a>&nbsp;&nbsp;
      <a href="#M000090">number_of_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000097">prepare_inputs</a>&nbsp;&nbsp;
      <a href="#M000096">prepare_inputs</a>&nbsp;&nbsp;
      <a href="#M000110">read_entries_from_file!</a>&nbsp;&nbsp;
      <a href="#M000155">read_entries_from_open_file!</a>&nbsp;&nbsp;
      <a href="#M000135">root</a>&nbsp;&nbsp;
      <a href="#M000137">root_exists?</a>&nbsp;&nbsp;
      <a href="#M000091">row_distribution</a>&nbsp;&nbsp;
      <a href="#M000099">row_file_path</a>&nbsp;&nbsp;
      <a href="#M000098">row_filename</a>&nbsp;&nbsp;
      <a href="#M000093">rows</a>&nbsp;&nbsp;
      <a href="#M000130">stages</a>&nbsp;&nbsp;
      <a href="#M000083">statistics</a>&nbsp;&nbsp;
      <a href="#M000115">uniq_cols</a>&nbsp;&nbsp;
      <a href="#M000114">uniq_columns</a>&nbsp;&nbsp;
      <a href="#M000112">uniq_rows</a>&nbsp;&nbsp;
      <a href="#M000116">unique_cols</a>&nbsp;&nbsp;
      <a href="#M000143">unique_column_sql</a>&nbsp;&nbsp;
      <a href="#M000113">unique_columns</a>&nbsp;&nbsp;
      <a href="#M000119">unique_columns_by_row</a>&nbsp;&nbsp;
      <a href="#M000084">unique_descriptor</a>&nbsp;&nbsp;
      <a href="#M000139">unique_entry_value_sql</a>&nbsp;&nbsp;
      <a href="#M000142">unique_row_sql</a>&nbsp;&nbsp;
      <a href="#M000111">unique_rows</a>&nbsp;&nbsp;
      <a href="#M000117">unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000140">unique_vector_sql</a>&nbsp;&nbsp;
      <a href="#M000153">update_column_count</a>&nbsp;&nbsp;
      <a href="#M000154">update_column_count!</a>&nbsp;&nbsp;
      <a href="#M000151">update_row_count</a>&nbsp;&nbsp;
      <a href="#M000152">update_row_count!</a>&nbsp;&nbsp;
      <a href="#M000134">work_root</a>&nbsp;&nbsp;
      <a href="#M000125">write</a>&nbsp;&nbsp;
      <a href="#M000127">write!</a>&nbsp;&nbsp;
      <a href="#M000147">write_cells</a>&nbsp;&nbsp;
      <a href="#M000144">write_options</a>&nbsp;&nbsp;
      <a href="#M000124">write_rows</a>&nbsp;&nbsp;
      <a href="#M000123">write_rows!</a>&nbsp;&nbsp;
      <a href="#M000146">write_saved</a>&nbsp;&nbsp;
      <a href="#M000145">write_saved_rows</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">create_from_file!</span><span class="method-args">(filename, attributes = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new matrix from a file (path/string, not stream). File should
contain either a list of <a href="Matrix.html#M000093">rows</a> or a set of
pairs which denote cells with true values. In certain cases, these cells
can also mask a parent matrix &#8212; namely, if this matrix itself has no
children, but does have a parent.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 385</span>
385:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">attributes</span> = {})
386:     
387:     <span class="ruby-comment cmt"># Infer as much information as possible.</span>
388:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:row_species</span>] = (<span class="ruby-identifier">infer_species_from_filename</span>(<span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;Hs&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:row_species</span>)
389:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:column_species</span>] = <span class="ruby-value str">&quot;Hs&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:column_species</span>)
390:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:entry_info_id</span>] = <span class="ruby-constant">EntryInfo</span>.<span class="ruby-identifier">find_or_create!</span>(<span class="ruby-value str">&quot;gene&quot;</span>, <span class="ruby-value str">&quot;phenotype&quot;</span>).<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:entry_info_id</span>)
391:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:title</span>] = <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:title</span>)
392:     
393:     <span class="ruby-identifier">m</span> = <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">attributes</span>)
394:     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">filename</span>)
395:     <span class="ruby-identifier">m</span>
396:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">create_from_file_pair!</span><span class="method-args">(row_filename, cell_filename, attributes = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new matrix from two files, one consisting of a list of <a
href="Matrix.html#M000093">rows</a>, and the other a list of cells with
true values.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 362</span>
362:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file_pair!</span>(<span class="ruby-identifier">row_filename</span>, <span class="ruby-identifier">cell_filename</span>, <span class="ruby-identifier">attributes</span> = {})
363:     <span class="ruby-identifier">m</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">row_filename</span>, <span class="ruby-identifier">attributes</span>)
364:     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">cell_filename</span>)
365:     <span class="ruby-identifier">m</span>
366:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">create_from_file_pairs!</span><span class="method-args">(row_and_cell_filenames)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls <a href="Matrix.html#M000106">create_from_file_pair!</a> for each
pair of filenames. In each pair should be a row file and a cell file.
Returns the matrices that were created.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 371</span>
371:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file_pairs!</span>(<span class="ruby-identifier">row_and_cell_filenames</span>)
372:     <span class="ruby-identifier">matrices</span> = []
373:     <span class="ruby-identifier">row_and_cell_filenames</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file_pair</span><span class="ruby-operator">|</span>
374:       <span class="ruby-identifier">matrices</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create_from_file_pair!</span>(<span class="ruby-identifier">file_pair</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">file_pair</span>[<span class="ruby-value">1</span>])
375:     <span class="ruby-keyword kw">end</span>
376:     <span class="ruby-identifier">matrices</span>
377:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">create_from_files!</span><span class="method-args">(list_of_files)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates several new matrices from a series of files.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 399</span>
399:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_files!</span>(<span class="ruby-identifier">list_of_files</span>)
400:     <span class="ruby-identifier">res</span> = []
401:     <span class="ruby-identifier">list_of_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
402:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">file</span>)
403:     <span class="ruby-keyword kw">end</span>
404:     <span class="ruby-identifier">res</span>
405:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000096" class="method-detail">
        <a name="M000096"></a>

        <div class="method-heading">
          <a href="#M000096" class="method-signature">
          <span class="method-name">prepare_inputs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Phenolog-specific function. Prepare working directory for all matrices and
their experiments.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000096-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000096-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 281</span>
281:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">prepare_inputs</span>
282:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
283:       <span class="ruby-identifier">m</span>.<span class="ruby-identifier">prepare_inputs</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LeafMatrix</span>)
284:     <span class="ruby-keyword kw">end</span>
285: 
286:     <span class="ruby-comment cmt"># Only create experiments after matrices have been created</span>
287:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
288:       <span class="ruby-identifier">m</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">exp</span>.<span class="ruby-identifier">prepare_inputs</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LeafMatrix</span>)
289:     <span class="ruby-keyword kw">end</span>
290:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">work_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 575</span>
575:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_root</span>
576:     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;tmp/work&quot;</span>
577:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <span class="method-name">all_rows</span><span class="method-args">(j = nil)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000093">rows</a>
</p>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">cell_file_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 312</span>
312:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell_file_path</span>
313:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell_filename</span>
314:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000100" class="method-detail">
        <a name="M000100"></a>

        <div class="method-heading">
          <a href="#M000100" class="method-signature">
          <span class="method-name">cell_filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000100-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000100-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 307</span>
307:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell_filename</span>
308:     <span class="ruby-comment cmt"># This seems counter-intuitive, but it is correct. Hopefully.</span>
309:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">cell_filename</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span>)
310:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">cells_for_display</span><span class="method-args">(res = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this when displaying the matrix, e.g. through Rails.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_for_display</span>(<span class="ruby-identifier">res</span> = {})
318:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
319:       <span class="ruby-identifier">res</span>[<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value str">&quot;:&quot;</span>)] = <span class="ruby-constant">CellValue</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">false</span>)
320:     <span class="ruby-keyword kw">end</span>
321: 
322:     <span class="ruby-identifier">res</span>
323:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000128" class="method-detail">
        <a name="M000128"></a>

        <div class="method-heading">
          <a href="#M000128" class="method-signature">
          <span class="method-name">children_filenames</span><span class="method-args">(file_prefix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000128-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000128-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 501</span>
501:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_filenames</span> <span class="ruby-identifier">file_prefix</span>
502:     <span class="ruby-identifier">l</span> = []
503:     <span class="ruby-comment cmt">#if self.children.first.mask?</span>
504:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
505:         <span class="ruby-identifier">l</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">child_filename_internal</span>(<span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child</span>)
506:       <span class="ruby-keyword kw">end</span>
507:     <span class="ruby-comment cmt">#end</span>
508:     <span class="ruby-identifier">l</span>
509:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">children_have_been_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If this is true, we can run a meta-analysis (the second-stage
crossvalidation).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 334</span>
334:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_have_been_run?</span>
335:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">true</span>
336:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">false</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
337: 
338:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
339:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&amp;&amp;=</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">has_been_run?</span>
340:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>
341:     <span class="ruby-keyword kw">end</span>
342:     
343:     <span class="ruby-identifier">res</span>
344:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000092" class="method-detail">
        <a name="M000092"></a>

        <div class="method-heading">
          <a href="#M000092" class="method-signature">
          <span class="method-name">column_indeces</span><span class="method-args">(i = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get all columns or all columns with row <em>i</em>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000092-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000092-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_indeces</span>(<span class="ruby-identifier">i</span> = <span class="ruby-keyword kw">nil</span>)
247:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indeces_by_row_or_column</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">:j</span>, <span class="ruby-identifier">i</span>)
248:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <a href="#M000086" class="method-signature">
          <span class="method-name">copy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Make a <a href="Matrix.html#M000086">copy</a> of the matrix in memory. This
also copies all of the cells and empty <a
href="Matrix.html#M000093">rows</a> in the matrix.
</p>
<p>
Do not attempt to use it on a test set. This behavior is not tested.
</p>
<p>
Note that the matrix returned will not yet be saved.
</p>
<p>
This will not <a href="Matrix.html#M000086">copy</a> sub-ordinates of the
matrix (such as experiments).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000086-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000086-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 141</span>
141:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy</span>
142:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clone</span>
143:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; copy&quot;</span>
144:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
145:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;matrix_id&quot;</span>})
146:     <span class="ruby-keyword kw">end</span>
147:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">empty_row</span><span class="ruby-operator">|</span>
148:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">empty_row</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;matrix_id&quot;</span>})
149:     <span class="ruby-keyword kw">end</span>
150:     <span class="ruby-identifier">matrix_copy</span>
151:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000088" class="method-detail">
        <a name="M000088"></a>

        <div class="method-heading">
          <a href="#M000088" class="method-signature">
          <span class="method-name">copy_and_randomize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Note that this function only works for very sparse matrices. Once columns
start to be dense enough for lots of collisions, this gets exponentially
slower.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000088-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000088-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 179</span>
179:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_and_randomize</span>
180:     <span class="ruby-comment cmt"># Get the rows and columns</span>
181:     <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span>
182: 
183:     <span class="ruby-comment cmt"># Make an empty copy and to help it along give it the rows (one less db op)</span>
184:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_empty_copy</span> <span class="ruby-identifier">uqr</span>
185:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;r&quot;</span>
186:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">column_species</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;r&quot;</span>
187: 
188:     <span class="ruby-comment cmt"># Now we have to save the copy in order to do the randomization.</span>
189:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">save!</span>
190: 
191:     <span class="ruby-comment cmt"># Now go through and</span>
192:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_rows_by_column</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span>, <span class="ruby-identifier">num</span><span class="ruby-operator">|</span>
193: 
194:       <span class="ruby-identifier">rand_column_contents</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
195:       <span class="ruby-comment cmt"># draw num from uqr for this column</span>
196:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">rand_column_contents</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">num</span>
197:         <span class="ruby-identifier">rand_column_contents</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">uqr</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">size</span>)]
198:       <span class="ruby-keyword kw">end</span>
199: 
200:       <span class="ruby-identifier">rand_column_contents</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
201:         <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">col</span>)
202:       <span class="ruby-keyword kw">end</span>
203:     <span class="ruby-keyword kw">end</span>
204: 
205:     <span class="ruby-comment cmt"># Now save the matrix copy and update the column count</span>
206:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">update_column_count!</span>
207:     <span class="ruby-identifier">matrix_copy</span>
208:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">count_unique_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 449</span>
449:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_columns</span>
450:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_column_sql</span>(<span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_i</span>
451:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">count_unique_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 453</span>
453:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows</span>
454:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_row_sql</span>(<span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_i</span>
455:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">count_unique_rows_by_column</span><span class="method-args">(which_i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 445</span>
445:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows_by_column</span>(<span class="ruby-identifier">which_i</span>)
446:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">which_i</span>, <span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>
447:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">count_unique_rows_by_column</span><span class="method-args">(which_j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 437</span>
437:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows_by_column</span>(<span class="ruby-identifier">which_j</span>)
438:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">which_j</span>, <span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>
439:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000089" class="method-detail">
        <a name="M000089"></a>

        <div class="method-heading">
          <a href="#M000089" class="method-signature">
          <span class="method-name">density</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gives a metric describing the number of cells in the matrix as a fraction
of the size &#8212; in terms of the number of cells per column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000089-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000089-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 212</span>
212:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">density</span>
213:     (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">column_count</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>
214:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="#M000085" class="method-signature">
          <span class="method-name">destroy_borked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls destroy, but first deletes the matrix directory on the filesystem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000085-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000085-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 126</span>
126:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_borked</span>
127:     <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">work_root</span>)
128:     <span class="ruby-identifier">destroy</span>
129:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">dir_exists?</span><span class="method-args">(dir)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 583</span>
583:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dir_exists?</span> <span class="ruby-identifier">dir</span>
584:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">dir</span>)
585:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">fractalize</span><span class="method-args">(folds, shuffle=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create n random subsets of this matrix, each of size (s * (n-1 / n)). If
supplied with a list, repeats recursively for each of the subsets. If
supplied with an integer, creates subsets which are of size (s / n), which
serve as masks.
</p>
<p>
n is specified by folds, which can be a Fixnum or an <a
href="Array.html">Array</a> (containing Fixnum).
</p>
<p>
By setting shuffle to false, you&#8216;re telling it not to randomize the
<a href="Matrix.html#M000093">rows</a> that end up as test sets. (Having
shuffle as true has no effect on the row or column contents. That is
handled by <a href="Matrix.html#M000088">copy_and_randomize</a>.)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 533</span>
533:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fractalize</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">shuffle</span>=<span class="ruby-keyword kw">true</span>)
534:     <span class="ruby-comment cmt"># Convert to an array even if there is only one</span>
535:     <span class="ruby-identifier">folds</span> = [<span class="ruby-identifier">folds</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>)
536: 
537:     <span class="ruby-comment cmt"># Set up the methods for fractalization -- there should be one for each of</span>
538:     <span class="ruby-comment cmt"># the entries in the folds argument</span>
539:     <span class="ruby-identifier">methods</span> = []
540:     <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">fold</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">methods</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">:row</span>  }
541:     
542:     <span class="ruby-identifier">fractalize_by_method</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>)
543:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">fractalize_by_method</span><span class="method-args">(folds, methods, shuffle=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Does the work for <a href="Matrix.html#M000131">fractalize</a>, but also
allows cross-validation methods (row or cell) to be specified. This
functionality was deprecated when we couldn&#8216;t figure out how to do
cell-based cross-validation.
</p>
<p>
This function used to be called simply <a
href="Matrix.html#M000131">fractalize</a>. You should use that function
instead.
</p>
<p>
Note that folds and methods must both be arrays, and they must have equal
size.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 554</span>
554:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fractalize_by_method</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>=<span class="ruby-keyword kw">true</span>)
555: 
556:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
557:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>,<span class="ruby-value str">&quot;folds and methods must be arrays of equal non-zero size&quot;</span>)
558:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;folds and methods must be the same size&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">size</span>
559:     <span class="ruby-keyword kw">end</span>
560: 
561:     <span class="ruby-identifier">fractalize_by_method_internal</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>)
562:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">has_been_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if all experiments have been run for a matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 347</span>
347:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_been_run?</span>
348:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">true</span>
349:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">false</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
350: 
351:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">experiment</span><span class="ruby-operator">|</span>
352:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&amp;&amp;=</span> <span class="ruby-identifier">experiment</span>.<span class="ruby-identifier">has_been_run?</span>
353:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>
354:     <span class="ruby-keyword kw">end</span>
355: 
356:     <span class="ruby-identifier">res</span>
357:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000129" class="method-detail">
        <a name="M000129"></a>

        <div class="method-heading">
          <a href="#M000129" class="method-signature">
          <span class="method-name">has_experiments_to_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000129-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000129-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 512</span>
512:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_experiments_to_run?</span>
513:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">not_run</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
514:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="#M000095" class="method-signature">
          <span class="method-name">indeces_by_row_or_column</span><span class="method-args">(sym, other_sym, val = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This is essentially a matrix slice function.
</p>
<p>
If you want column indeces, give it :i, :j. If you want row indeces, give
it :j, :i. The third argument is the row or column index you want.
</p>
<p>
If you provide no third argument, it&#8216;ll return all unique columns or
<a href="Matrix.html#M000093">rows</a>, I think, but I can&#8216;t remember
why I wrote it this way. Play around with it.
</p>
<p>
Also note that this slice function is not properly overridden on
LeafMatrices. It will give you the mask contents, which might be the
complement of what you expect.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000095-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000095-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 271</span>
271:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indeces_by_row_or_column</span>(<span class="ruby-identifier">sym</span>, <span class="ruby-identifier">other_sym</span>, <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">nil</span>)
272:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
273:       <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">other_sym</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> }
274:     <span class="ruby-keyword kw">else</span>
275:       <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">sym</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>}).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">other_sym</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> }
276:     <span class="ruby-keyword kw">end</span>
277:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">is_phenomatrix?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Depends on entry_infos &#8212; genes and phenotypes as the row and column
titles indicate phenomatrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 488</span>
488:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_phenomatrix?</span>
489:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">row_title</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;gene&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">column_title</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;phenotype&quot;</span>
490:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">ls</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
List files and dirs in the matrix directory
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 592</span>
592:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ls</span>
593:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">root</span>).<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;.&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">e</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;..&quot;</span> }
594:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <a href="#M000087" class="method-signature">
          <span class="method-name">make_empty_copy</span><span class="method-args">(uqr = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Makes an empty matrix with the same number of <a
href="Matrix.html#M000093">rows</a> as the original in memory, but does not
save it.
</p>
<p>
Since the matrix is stored in row format, no guarantee is made about the
number of columns.
</p>
<p>
This function is called by <a
href="Matrix.html#M000088">copy_and_randomize</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000087-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000087-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 160</span>
160:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_empty_copy</span> <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">nil</span>
161:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clone</span>
162:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; copy&quot;</span>
163: 
164:     <span class="ruby-comment cmt"># Get the rows and columns</span>
165:     <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">nil?</span>
166: 
167:     <span class="ruby-comment cmt"># First create empty rows</span>
168:     <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
169:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span>)
170:     <span class="ruby-keyword kw">end</span>
171:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">row_count</span>    = <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">size</span>
172:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">column_count</span> = <span class="ruby-value">0</span>
173:     <span class="ruby-identifier">matrix_copy</span>
174:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">make_inputs</span><span class="method-args">(rows_filename, cells_filename, file_prefix = &quot;testset&quot;, dest_dir = self.root)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generate two files in the current directory, one containing the row
indeces, the other containing the cells in the matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 566</span>
566:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_inputs</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>, <span class="ruby-identifier">file_prefix</span> = <span class="ruby-value str">&quot;testset&quot;</span>, <span class="ruby-identifier">dest_dir</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>
567:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dest_dir</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">dest_dir</span>)
568:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">dest_dir</span>) <span class="ruby-keyword kw">do</span>
569:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_inputs_internal</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>
570:       
571:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_children_as_testsets</span> <span class="ruby-identifier">file_prefix</span>
572:     <span class="ruby-keyword kw">end</span>
573:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">number_of_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gives the number of <a href="Matrix.html#M000093">rows</a> in the <a
href="Matrix.html#M000135">root</a> of the tree of matrices. That means if
this is a cross-validation submatrix, we return the <a
href="Matrix.html#M000135">root</a>&#8216;s row count.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 328</span>
328:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_rows</span>
329:     <span class="ruby-identifier">row_count</span>
330:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000090" class="method-detail">
        <a name="M000090"></a>

        <div class="method-heading">
          <a href="#M000090" class="method-signature">
          <span class="method-name">number_of_rows_by_column</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get a hash of the column identifiers to the number of <a
href="Matrix.html#M000093">rows</a> that have non-zero values in that
column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000090-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000090-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_rows_by_column</span>
219:     <span class="ruby-identifier">num_rows_by_column</span> = {}
220:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_rows</span>(<span class="ruby-value str">&quot;SELECT j, COUNT(DISTINCT entries.i) AS count_i FROM matrices\nINNER JOIN entries ON (entries.matrix_id = matrices.id)\nWHERE entries.type = 'Cell' AND matrices.id = \#{self.id} GROUP BY j\n&quot;</span>
221:     ).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
222:       <span class="ruby-identifier">num_rows_by_column</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>] = <span class="ruby-identifier">row</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
223:     <span class="ruby-keyword kw">end</span>
224:     <span class="ruby-identifier">num_rows_by_column</span>
225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000097" class="method-detail">
        <a name="M000097"></a>

        <div class="method-heading">
          <a href="#M000097" class="method-signature">
          <span class="method-name">prepare_inputs</span><span class="method-args">(force = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Phenolog-specific function. Prepare working directory for the matrix. If
force is set to true, the contents will be overwritten.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000097-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000097-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 295</span>
295:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_inputs</span>(<span class="ruby-identifier">force</span> = <span class="ruby-keyword kw">false</span>)
296:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_inputs</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_filename</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell_filename</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root_exists?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">force</span>
297:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">read_entries_from_file!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Given a file stream or filename, read into this matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 408</span>
408:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">file</span>)
409:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Pathname</span>)
410:       <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;r&quot;</span>))
411:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">File</span>)
412:       <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-identifier">file</span>)
413:     <span class="ruby-keyword kw">else</span>
414:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Expected filename or file as argument&quot;</span>
415:       <span class="ruby-keyword kw">false</span>
416:     <span class="ruby-keyword kw">end</span>
417:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 579</span>
579:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root</span>
580:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">work_root</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;matrix_#{self.id}&quot;</span>
581:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">root_exists?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 587</span>
587:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root_exists?</span>
588:     <span class="ruby-identifier">dir_exists?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>)
589:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000091" class="method-detail">
        <a name="M000091"></a>

        <div class="method-heading">
          <a href="#M000091" class="method-signature">
          <span class="method-name">row_distribution</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Order the columns by the number of <a href="Matrix.html#M000093">rows</a>
and build as a list of lists, for plotting with flotomatic.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000091-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000091-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 235</span>
235:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_distribution</span>
236:     <span class="ruby-identifier">num_rows_by_col</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_rows_by_column</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">sort</span>
237:     <span class="ruby-identifier">num_rows_by_col</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
238:       <span class="ruby-identifier">val</span> = <span class="ruby-identifier">num_rows_by_col</span>[<span class="ruby-identifier">i</span>]
239:       <span class="ruby-identifier">num_rows_by_col</span>[<span class="ruby-identifier">i</span>] = [<span class="ruby-identifier">i</span>, <span class="ruby-identifier">val</span>]
240:     <span class="ruby-keyword kw">end</span>
241:     <span class="ruby-identifier">num_rows_by_col</span>
242:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="#M000099" class="method-signature">
          <span class="method-name">row_file_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000099-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000099-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 303</span>
303:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_file_path</span>
304:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_filename</span>
305:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000098" class="method-detail">
        <a name="M000098"></a>

        <div class="method-heading">
          <a href="#M000098" class="method-signature">
          <span class="method-name">row_filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000098-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000098-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 299</span>
299:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_filename</span>
300:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">row_filename</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span>)
301:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="#M000093" class="method-signature">
          <span class="method-name">rows</span><span class="method-args">(j = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get all row indeces or, if an arg <em>j</em> is provided, all those with
column <em>j</em>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000093-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000093-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 251</span>
251:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rows</span>(<span class="ruby-identifier">j</span> = <span class="ruby-keyword kw">nil</span>)
252:     <span class="ruby-identifier">indeces_by_row_or_column</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">:i</span>, <span class="ruby-identifier">j</span>)
253:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">stages</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the number of <a href="Matrix.html#M000130">stages</a> of
cross-validation this matrix is set up for.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 518</span>
518:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stages</span>
519:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
520:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">stages</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># recursive.</span>
521:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000083" class="method-detail">
        <a name="M000083"></a>

        <div class="method-heading">
          <a href="#M000083" class="method-signature">
          <span class="method-name">statistics</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get a hash of <a href="Matrix.html#M000083">statistics</a> on this matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000083-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000083-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 110</span>
110:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">statistics</span>
111:     <span class="ruby-identifier">h</span> = {}
112:     <span class="ruby-identifier">h</span>[<span class="ruby-value str">&quot;DB cells&quot;</span>] = <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;matrix_id = ?&quot;</span>,<span class="ruby-identifier">id</span>])
113:     <span class="ruby-identifier">h</span>[<span class="ruby-value str">&quot;DB entries&quot;</span>] = <span class="ruby-constant">Entry</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;matrix_id = ?&quot;</span>,<span class="ruby-identifier">id</span>])
114:     <span class="ruby-identifier">h</span>[<span class="ruby-value str">&quot;DB empty_rows&quot;</span>] = <span class="ruby-constant">EmptyRow</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;matrix_id = ?&quot;</span>,<span class="ruby-identifier">id</span>])
115:     <span class="ruby-identifier">h</span>
116:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <span class="method-name">uniq_cols</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000113">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <span class="method-name">uniq_columns</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000113">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <span class="method-name">uniq_rows</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000111">unique_rows</a>
</p>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <span class="method-name">unique_cols</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000113">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">unique_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get unique columns in the matrix (identical to <a
href="Matrix.html#M000111">unique_rows</a>, but columns instead).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 426</span>
426:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_columns</span>
427:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_column_sql</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
428:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">unique_columns_by_row</span><span class="method-args">(which_i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 441</span>
441:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_columns_by_row</span>(<span class="ruby-identifier">which_i</span>)
442:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">which_i</span>)).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
443:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <a href="#M000084" class="method-signature">
          <span class="method-name">unique_descriptor</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A descriptor which uniquely identifies a matrix, useful for drop-down boxes
particularly when title is the same for multiple matrices. In this case,
it&#8216;s the ID and the title.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000084-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000084-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 121</span>
121:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_descriptor</span>
122:     <span class="ruby-node">&quot;#{self.id}: #{self.title}&quot;</span>
123:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">unique_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get a list of unique <a href="Matrix.html#M000093">rows</a> in the matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 420</span>
420:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_rows</span>
421:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_row_sql</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
422:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">unique_rows_by_column</span><span class="method-args">(which_j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 433</span>
433:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_rows_by_column</span>(<span class="ruby-identifier">which_j</span>)
434:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">which_j</span>)).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
435:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">write</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write a single matrix, not its children.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 476</span>
476:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
477:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
478:     
479:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
480:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;Need to save the matrix before trying to write its contents. Call write! instead if you want to force a save.&quot;</span>
481:     <span class="ruby-keyword kw">else</span>
482:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">opts</span>)
483:     <span class="ruby-keyword kw">end</span>
484:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000127" class="method-detail">
        <a name="M000127"></a>

        <div class="method-heading">
          <a href="#M000127" class="method-signature">
          <span class="method-name">write!</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Force a save before writing; otherwise, same as <a
href="Matrix.html#M000125">write</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000127-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000127-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 493</span>
493:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write!</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
494:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
495:     
496:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
497:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">opts</span>)
498:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">write_rows</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write a single matrix&#8216;s row indeces.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 465</span>
465:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_rows</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
466:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
467:     
468:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
469:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;Sorry, you need to save the matrix before trying to write its contents. Call write_rows! instead if you want to force a save.&quot;</span>
470:     <span class="ruby-keyword kw">else</span>
471:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved_rows</span>(<span class="ruby-identifier">file</span>)
472:     <span class="ruby-keyword kw">end</span>
473:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">write_rows!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write all row indeces to a file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 459</span>
459:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_rows!</span>(<span class="ruby-identifier">file</span>)
460:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
461:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved_rows</span>(<span class="ruby-identifier">file</span>)
462:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">cells_by_row</span><span class="method-args">(i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 676</span>
676:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_by_row</span> <span class="ruby-identifier">i</span>
677:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@built_rows</span>)
678:       <span class="ruby-identifier">target</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>
679:       <span class="ruby-identifier">target</span> = <span class="ruby-identifier">target</span>.<span class="ruby-identifier">parent</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">target</span>.<span class="ruby-identifier">new_record?</span>
680:       <span class="ruby-identifier">target</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>}).<span class="ruby-identifier">dup</span>
681:     <span class="ruby-keyword kw">else</span>
682:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>})
683:     <span class="ruby-keyword kw">end</span>
684:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <a href="#M000150" class="method-signature">
          <span class="method-name">create_empty_row!</span><span class="method-args">(i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000150-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000150-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 691</span>
691:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_empty_row!</span>(<span class="ruby-identifier">i</span>)
692:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>)
693:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">find_or_create_cell!</span><span class="method-args">(i, j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 687</span>
687:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">j</span>)
688:     <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find_or_create!</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">j</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>)
689:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000141" class="method-detail">
        <a name="M000141"></a>

        <div class="method-heading">
          <a href="#M000141" class="method-signature">
          <span class="method-name">make_inputs_internal</span><span class="method-args">(rows_filename, cells_filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000141-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000141-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 624</span>
624:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_inputs_internal</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>
625:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_rows</span>(<span class="ruby-identifier">rows_filename</span>)
626:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">cells_filename</span>)
627:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000155" class="method-detail">
        <a name="M000155"></a>

        <div class="method-heading">
          <a href="#M000155" class="method-signature">
          <span class="method-name">read_entries_from_open_file!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Read a list of cells or <a href="Matrix.html#M000093">rows</a>. If a single
entry in a line, it&#8216;s an empty row (meaning no cells in that row). If
two entries, it&#8216;s a cell with a true value in it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000155-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000155-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 717</span>
717:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-identifier">file</span>)
718:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">gets</span>
719:       <span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp!</span>
720:       <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\t&quot;</span>)
721: 
722:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># List of rows.</span>
723:         <span class="ruby-comment cmt"># Create a row.</span>
724:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_empty_row!</span>(<span class="ruby-identifier">fields</span>[<span class="ruby-value">0</span>])
725:       <span class="ruby-keyword kw">else</span>
726:         <span class="ruby-comment cmt"># Convert a row to a cell (or just create a cell).</span>
727:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">fields</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">fields</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>)
728:       <span class="ruby-keyword kw">end</span>
729:     <span class="ruby-keyword kw">end</span>
730: 
731:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_column_count!</span>
732:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_row_count!</span>
733:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000143" class="method-detail">
        <a name="M000143"></a>

        <div class="method-heading">
          <a href="#M000143" class="method-signature">
          <span class="method-name">unique_column_sql</span><span class="method-args">(count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000143-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000143-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 633</span>
633:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_column_sql</span>(<span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
634:     <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-value str">&quot;j&quot;</span>, <span class="ruby-identifier">count</span>)
635:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">unique_entry_value_sql</span><span class="method-args">(field, count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used for returning either row or column of every entry corresponding to
this matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 599</span>
599:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
600:     <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SELECT &quot;</span>
601:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">count</span>
602:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;COUNT(DISTINCT #{Entry.table_name}.#{field}) &quot;</span>
603:     <span class="ruby-keyword kw">else</span>
604:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;DISTINCT #{Entry.table_name}.#{field} &quot;</span>
605:     <span class="ruby-keyword kw">end</span>
606:     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;FROM \#{Matrix.table_name}\nINNER JOIN \#{Entry.table_name} ON (\#{Entry.table_name}.matrix_id = \#{Matrix.table_name}.id)\nWHERE \#{Matrix.table_name}.id = \#{self.id}\n&quot;</span>
607:     <span class="ruby-identifier">sql</span>
608:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000142" class="method-detail">
        <a name="M000142"></a>

        <div class="method-heading">
          <a href="#M000142" class="method-signature">
          <span class="method-name">unique_row_sql</span><span class="method-args">(count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000142-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000142-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 629</span>
629:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_row_sql</span>(<span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
630:     <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-value str">&quot;i&quot;</span>, <span class="ruby-identifier">count</span>)
631:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000140" class="method-detail">
        <a name="M000140"></a>

        <div class="method-heading">
          <a href="#M000140" class="method-signature">
          <span class="method-name">unique_vector_sql</span><span class="method-args">(field, at, count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000140-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000140-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 616</span>
616:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">at</span>, <span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
617:     <span class="ruby-identifier">vf</span> = <span class="ruby-identifier">field</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;i&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;j&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;i&quot;</span>
618:     <span class="ruby-identifier">sql</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">count</span>)
619:     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; AND #{Entry.table_name}.#{vf} = #{at}&quot;</span>
620:     <span class="ruby-identifier">sql</span>
621:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000153" class="method-detail">
        <a name="M000153"></a>

        <div class="method-heading">
          <a href="#M000153" class="method-signature">
          <span class="method-name">update_column_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000153-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000153-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 704</span>
704:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_column_count</span>
705:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_count</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">count_unique_columns</span>
706:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000154" class="method-detail">
        <a name="M000154"></a>

        <div class="method-heading">
          <a href="#M000154" class="method-signature">
          <span class="method-name">update_column_count!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000154-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000154-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 708</span>
708:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_column_count!</span>
709:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_column_count</span>
710:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
711:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000151" class="method-detail">
        <a name="M000151"></a>

        <div class="method-heading">
          <a href="#M000151" class="method-signature">
          <span class="method-name">update_row_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000151-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000151-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 695</span>
695:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_row_count</span>
696:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_count</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">count_unique_rows</span>
697:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000152" class="method-detail">
        <a name="M000152"></a>

        <div class="method-heading">
          <a href="#M000152" class="method-signature">
          <span class="method-name">update_row_count!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000152-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000152-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 699</span>
699:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_row_count!</span>
700:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_row_count</span>
701:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
702:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">write_cells</span><span class="method-args">(open_file, options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write the cells of the matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 669</span>
669:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_cells</span>(<span class="ruby-identifier">open_file</span>, <span class="ruby-identifier">options</span>)
670:     <span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
671:       <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">open_file</span>)
672:     <span class="ruby-keyword kw">end</span>
673:     <span class="ruby-identifier">open_file</span>
674:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000144" class="method-detail">
        <a name="M000144"></a>

        <div class="method-heading">
          <a href="#M000144" class="method-signature">
          <span class="method-name">write_options</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the default options for <a href="Matrix.html#M000125">write</a>()
and the functions it calls.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000144-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000144-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 639</span>
639:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span> = {}
640:     {
641:       <span class="ruby-identifier">:header</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
642:     }.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">options</span>
643:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">write_saved</span><span class="method-args">(file, options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this to force writing of a matrix that has already been saved. It may
work with an unsaved file, but behavior could be unpredictable and it would
likely be a bad idea.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 653</span>
653:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span>)
654:     
655:     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">file</span>
656:     <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Pathname</span>)
657: 
658:     <span class="ruby-comment cmt"># write the header</span>
659:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">matrix_info</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:header</span>]
660: 
661:     <span class="ruby-identifier">write_cells</span>(<span class="ruby-identifier">f</span>, <span class="ruby-identifier">options</span>)
662: 
663:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
664:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">path</span>
665:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000145" class="method-detail">
        <a name="M000145"></a>

        <div class="method-heading">
          <a href="#M000145" class="method-signature">
          <span class="method-name">write_saved_rows</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See <a href="Matrix.html#M000146">write_saved</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000145-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000145-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 646</span>
646:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_saved_rows</span> <span class="ruby-identifier">file</span>
647:     <span class="ruby-identifier">writelines</span>(<span class="ruby-identifier">file</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span>)
648:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>