<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Matrix</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Matrix</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/matrix_rb.html">
                app/models/matrix.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Matrix.html">Matrix</a> class encapsulates three related but
essentially different sparse matrices, and is very purpose-specific.
</p>
<h1>Goals</h1>
<ul>
<li>Sparse storage

</li>
<li>Multi-level tree structure for storing cross-validation training and test
sets.

</li>
</ul>
<h1>Design</h1>
<h2>Tree Structure</h2>
<ul>
<li>Matrices in tree are either root/branch or leaf.

</li>
<li>Root/branch matrices are stored in their entirety.

</li>
<li>Leaf matrices are stored as masks of their parents (which are root/branch).

</li>
<li>The different levels can be divided in different folds (e.g., both
ten-fold, both five-fold, or one ten and one five, for example).

</li>
<li>Division of matrices is recursive, so you can have as many levels as you
want.

</li>
<li>If a matrix has no children or parents (i.e., it&#8216;s a singleton), it
is stored as a root/branch.

</li>
</ul>
<h2>Database Storage</h2>
<ul>
<li>Two classes of <a href="Entry.html">Entry</a> in the database: <a
href="Cell.html">Cell</a>, <a href="EmptyRow.html">EmptyRow</a> (children
of <a href="Entry.html">Entry</a>).

</li>
<li>Empty <a href="Matrix.html#M000062">columns</a> are not stored, as these
are not required for cross-validation.

</li>
<li>Empty <a href="Matrix.html#M000063">rows</a> mark genes which have no
phenotypes in an organism.

</li>
<li>An organism that lacks a gene will have no empty row.

</li>
<li>When a test set is generated from a root/branch matrix, and removal of
cells causes a row to become empty, an <a href="EmptyRow.html">EmptyRow</a>
is added to the test set matrix.

</li>
</ul>
<h2>Working Directory</h2>
<p>
Since matrix calculations occur outside of the Rails environment &#8212;
typically as binaries or scripts executed through the shell &#8212;
matrices must be output to the filesystem.
</p>
<p>
The function `<a href="Matrix.html#M000065">prepare_inputs</a>` is
responsible for initializing the working directory, which is in
`crossval/tmp/work`.
</p>
<p>
Each root/branch matrix has its own working directory in `tmp/work`, with
the directory name consisting of &#8216;matrix_&#8217; followed by the
unique ID for the matrix. For example, the Human non-random matrix is
`tmp/work/matrix_1/`.
</p>
<p>
The matrix directory includes, at a bare minimum:
</p>
<ul>
<li>`genes.Sp`, a list of the unique <a href="Matrix.html#M000063">rows</a> in
the matrix (typically by Entrez human gene ID)

</li>
<li>`genes_phenes.Sp`, a list of the cells in the matrix. The format of this
matrix is one line per cell, with the row (gene ID) in the first table
column and the column (phenotype ID) in the second table column.

</li>
</ul>
<p>
Note that Sp represents the species abbreviation, e.g., &#8216;Hs&#8217;.
If the matrix is a randomization, the suffix will be Spr, e.g.,
&#8216;Hsr&#8217;.
</p>
<p>
In addition, if test sets have been generated for the matrix, these will be
given by the identifier `testset.`; followed by the number of children
(immediate descendents) the matrix has; a dash; and the number of this
particular test set (starting at 0). For example, matrix 1 has
`testset.10-0` through `testset.10-9`. Each test set is formatted in the
same way as `genes_phenes.Sp`.
</p>
<h2>Subdirectories</h2>
<p>
Each matrix working directory may contain multiple sub-directories which
function as working directories for experiments. These are named in the
same manner as matrix working directories, e.g., `experiment_1` for the <a
href="Experiment.html">Experiment</a> with database ID 1.
</p>
<p>
The contents of these directories are given in the docs for the <a
href="Experiment.html">Experiment</a> class (and its children as
appropriate).
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000130">build_submatrices!</a>&nbsp;&nbsp;
      <a href="#M000070">cell_file_path</a>&nbsp;&nbsp;
      <a href="#M000069">cell_filename</a>&nbsp;&nbsp;
      <a href="#M000128">cells_by_row</a>&nbsp;&nbsp;
      <a href="#M000064">cells_by_row_or_column</a>&nbsp;&nbsp;
      <a href="#M000071">cells_for_display</a>&nbsp;&nbsp;
      <a href="#M000138">cells_for_display_as_masked</a>&nbsp;&nbsp;
      <a href="#M000139">cells_for_display_as_not_masked</a>&nbsp;&nbsp;
      <a href="#M000101">child_filename</a>&nbsp;&nbsp;
      <a href="#M000115">child_filename_internal</a>&nbsp;&nbsp;
      <a href="#M000103">children_file_paths</a>&nbsp;&nbsp;
      <a href="#M000102">children_filenames</a>&nbsp;&nbsp;
      <a href="#M000076">children_have_been_run?</a>&nbsp;&nbsp;
      <a href="#M000062">columns</a>&nbsp;&nbsp;
      <a href="#M000055">copy</a>&nbsp;&nbsp;
      <a href="#M000058">copy_and_randomize</a>&nbsp;&nbsp;
      <a href="#M000056">copy_and_save</a>&nbsp;&nbsp;
      <a href="#M000093">count_unique_columns</a>&nbsp;&nbsp;
      <a href="#M000094">count_unique_rows</a>&nbsp;&nbsp;
      <a href="#M000090">count_unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000092">count_unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000132">create_empty_row!</a>&nbsp;&nbsp;
      <a href="#M000080">create_from_file!</a>&nbsp;&nbsp;
      <a href="#M000078">create_from_file_pair!</a>&nbsp;&nbsp;
      <a href="#M000079">create_from_file_pairs!</a>&nbsp;&nbsp;
      <a href="#M000081">create_from_files!</a>&nbsp;&nbsp;
      <a href="#M000059">density</a>&nbsp;&nbsp;
      <a href="#M000111">dir_exists?</a>&nbsp;&nbsp;
      <a href="#M000131">find_or_create_cell!</a>&nbsp;&nbsp;
      <a href="#M000106">fractalize</a>&nbsp;&nbsp;
      <a href="#M000127">fractalize_internal</a>&nbsp;&nbsp;
      <a href="#M000077">has_been_run?</a>&nbsp;&nbsp;
      <a href="#M000104">has_experiments_to_run?</a>&nbsp;&nbsp;
      <a href="#M000098">is_phenomatrix?</a>&nbsp;&nbsp;
      <a href="#M000107">list_children</a>&nbsp;&nbsp;
      <a href="#M000057">make_empty_copy</a>&nbsp;&nbsp;
      <a href="#M000108">make_inputs</a>&nbsp;&nbsp;
      <a href="#M000116">make_inputs_internal</a>&nbsp;&nbsp;
      <a href="#M000129">make_submatrix_title</a>&nbsp;&nbsp;
      <a href="#M000075">mask?</a>&nbsp;&nbsp;
      <a href="#M000126">mask_fractalize_internal</a>&nbsp;&nbsp;
      <a href="#M000073">number_of_empty_rows</a>&nbsp;&nbsp;
      <a href="#M000074">number_of_rows</a>&nbsp;&nbsp;
      <a href="#M000060">number_of_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000072">number_of_unmasked_cells</a>&nbsp;&nbsp;
      <a href="#M000065">prepare_inputs</a>&nbsp;&nbsp;
      <a href="#M000066">prepare_inputs</a>&nbsp;&nbsp;
      <a href="#M000082">read_entries_from_file!</a>&nbsp;&nbsp;
      <a href="#M000137">read_entries_from_open_file!</a>&nbsp;&nbsp;
      <a href="#M000110">root</a>&nbsp;&nbsp;
      <a href="#M000112">root_exists?</a>&nbsp;&nbsp;
      <a href="#M000061">row_distribution</a>&nbsp;&nbsp;
      <a href="#M000068">row_file_path</a>&nbsp;&nbsp;
      <a href="#M000067">row_filename</a>&nbsp;&nbsp;
      <a href="#M000063">rows</a>&nbsp;&nbsp;
      <a href="#M000125">set_to_fractalize</a>&nbsp;&nbsp;
      <a href="#M000105">stages</a>&nbsp;&nbsp;
      <a href="#M000087">uniq_cols</a>&nbsp;&nbsp;
      <a href="#M000086">uniq_columns</a>&nbsp;&nbsp;
      <a href="#M000084">uniq_rows</a>&nbsp;&nbsp;
      <a href="#M000088">unique_cols</a>&nbsp;&nbsp;
      <a href="#M000118">unique_column_sql</a>&nbsp;&nbsp;
      <a href="#M000085">unique_columns</a>&nbsp;&nbsp;
      <a href="#M000091">unique_columns_by_row</a>&nbsp;&nbsp;
      <a href="#M000054">unique_descriptor</a>&nbsp;&nbsp;
      <a href="#M000113">unique_entry_value_sql</a>&nbsp;&nbsp;
      <a href="#M000117">unique_row_sql</a>&nbsp;&nbsp;
      <a href="#M000083">unique_rows</a>&nbsp;&nbsp;
      <a href="#M000089">unique_rows_by_column</a>&nbsp;&nbsp;
      <a href="#M000114">unique_vector_sql</a>&nbsp;&nbsp;
      <a href="#M000135">update_column_count</a>&nbsp;&nbsp;
      <a href="#M000136">update_column_count!</a>&nbsp;&nbsp;
      <a href="#M000133">update_row_count</a>&nbsp;&nbsp;
      <a href="#M000134">update_row_count!</a>&nbsp;&nbsp;
      <a href="#M000109">work_root</a>&nbsp;&nbsp;
      <a href="#M000097">write</a>&nbsp;&nbsp;
      <a href="#M000099">write!</a>&nbsp;&nbsp;
      <a href="#M000122">write_as_masked</a>&nbsp;&nbsp;
      <a href="#M000123">write_as_not_masked</a>&nbsp;&nbsp;
      <a href="#M000100">write_children_if_masks</a>&nbsp;&nbsp;
      <a href="#M000124">write_contents</a>&nbsp;&nbsp;
      <a href="#M000119">write_options</a>&nbsp;&nbsp;
      <a href="#M000096">write_rows</a>&nbsp;&nbsp;
      <a href="#M000095">write_rows!</a>&nbsp;&nbsp;
      <a href="#M000121">write_saved</a>&nbsp;&nbsp;
      <a href="#M000120">write_saved_rows</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000080" class="method-detail">
        <a name="M000080"></a>

        <div class="method-heading">
          <a href="#M000080" class="method-signature">
          <span class="method-name">create_from_file!</span><span class="method-args">(filename, attributes = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new matrix from a file (path/string, not stream). File should
contain either a list of <a href="Matrix.html#M000063">rows</a> or a set of
pairs which denote cells with true values. In certain cases, these cells
can also mask a parent matrix &#8212; namely, if this matrix itself has no
children, but does have a parent.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000080-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000080-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 343</span>
343:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">attributes</span> = {})
344:     
345:     <span class="ruby-comment cmt"># Infer as much information as possible.</span>
346:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:row_species</span>] = (<span class="ruby-identifier">infer_species_from_filename</span>(<span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;Hs&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:row_species</span>)
347:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:column_species</span>] = <span class="ruby-value str">&quot;Hs&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:column_species</span>)
348:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:entry_info_id</span>] = <span class="ruby-constant">EntryInfo</span>.<span class="ruby-identifier">find_or_create!</span>(<span class="ruby-value str">&quot;gene&quot;</span>, <span class="ruby-value str">&quot;phenotype&quot;</span>).<span class="ruby-identifier">id</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:entry_info_id</span>)
349:     <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:title</span>] = <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:title</span>)
350:     
351:     <span class="ruby-identifier">m</span> = <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">attributes</span>)
352:     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">filename</span>)
353:     <span class="ruby-identifier">m</span>
354:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">create_from_file_pair!</span><span class="method-args">(row_filename, cell_filename, attributes = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new matrix from two files, one consisting of a list of <a
href="Matrix.html#M000063">rows</a>, and the other a list of cells with
true values.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 320</span>
320:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file_pair!</span>(<span class="ruby-identifier">row_filename</span>, <span class="ruby-identifier">cell_filename</span>, <span class="ruby-identifier">attributes</span> = {})
321:     <span class="ruby-identifier">m</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">row_filename</span>, <span class="ruby-identifier">attributes</span>)
322:     <span class="ruby-identifier">m</span>.<span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">cell_filename</span>)
323:     <span class="ruby-identifier">m</span>
324:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000079" class="method-detail">
        <a name="M000079"></a>

        <div class="method-heading">
          <a href="#M000079" class="method-signature">
          <span class="method-name">create_from_file_pairs!</span><span class="method-args">(row_and_cell_filenames)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls <a href="Matrix.html#M000078">create_from_file_pair!</a> for each
pair of filenames. In each pair should be a row file and a cell file.
Returns the matrices that were created.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000079-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000079-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_file_pairs!</span>(<span class="ruby-identifier">row_and_cell_filenames</span>)
330:     <span class="ruby-identifier">matrices</span> = []
331:     <span class="ruby-identifier">row_and_cell_filenames</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file_pair</span><span class="ruby-operator">|</span>
332:       <span class="ruby-identifier">matrices</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create_from_file_pair!</span>(<span class="ruby-identifier">file_pair</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">file_pair</span>[<span class="ruby-value">1</span>])
333:     <span class="ruby-keyword kw">end</span>
334:     <span class="ruby-identifier">matrices</span>
335:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000081" class="method-detail">
        <a name="M000081"></a>

        <div class="method-heading">
          <a href="#M000081" class="method-signature">
          <span class="method-name">create_from_files!</span><span class="method-args">(list_of_files)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates several new matrices from a series of files.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000081-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000081-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 357</span>
357:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_from_files!</span>(<span class="ruby-identifier">list_of_files</span>)
358:     <span class="ruby-identifier">res</span> = []
359:     <span class="ruby-identifier">list_of_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
360:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">create_from_file!</span>(<span class="ruby-identifier">file</span>)
361:     <span class="ruby-keyword kw">end</span>
362:     <span class="ruby-identifier">res</span>
363:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">prepare_inputs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Prepare working directory for all matrices and their experiments.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 211</span>
211:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">prepare_inputs</span>
212:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
213:       <span class="ruby-identifier">m</span>.<span class="ruby-identifier">prepare_inputs</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">mask?</span>
214:     <span class="ruby-keyword kw">end</span>
215: 
216:     <span class="ruby-comment cmt"># Only create experiments after matrices have been created</span>
217:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
218:       <span class="ruby-identifier">m</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">exp</span>.<span class="ruby-identifier">prepare_inputs</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">mask?</span>
219:     <span class="ruby-keyword kw">end</span>
220:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">work_root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 541</span>
541:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">work_root</span>
542:     <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;tmp/work&quot;</span>
543:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">cell_file_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 240</span>
240:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell_file_path</span>
241:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell_filename</span>
242:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">cell_filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 235</span>
235:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cell_filename</span>
236:     <span class="ruby-comment cmt"># This seems counter-intuitive, but it is correct. Hopefully.</span>
237:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">cell_filename</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span>)
238:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <a href="#M000064" class="method-signature">
          <span class="method-name">cells_by_row_or_column</span><span class="method-args">(sym, other_sym, val = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000064-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000064-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 202</span>
202:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_by_row_or_column</span>(<span class="ruby-identifier">sym</span>, <span class="ruby-identifier">other_sym</span>, <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">nil</span>)
203:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
204:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">other_sym</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> }
205:     <span class="ruby-keyword kw">else</span>
206:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">sym</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>}).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">other_sym</span> }.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> }
207:     <span class="ruby-keyword kw">end</span>
208:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">cells_for_display</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this when displaying the matrix, e.g. through Rails. Will return all
cells, but
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_for_display</span>
247:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mask?</span> <span class="ruby-value">? </span><span class="ruby-identifier">cells_for_display_as_masked</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cells_for_display_as_not_masked</span>
248:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">child_filename</span><span class="method-args">(file_prefix, child_matrix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 468</span>
468:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child_filename</span> <span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child_matrix</span>
469:     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Matrix #{child_matrix.id} is not a mask and is therefore not located in the same directory as its parent.&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">child_matrix</span>.<span class="ruby-identifier">mask?</span>
470:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">child_filename_internal</span>(<span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child_matrix</span>)
471:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">children_file_paths</span><span class="method-args">(file_prefix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 483</span>
483:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_file_paths</span> <span class="ruby-identifier">file_prefix</span>
484:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children_filenames</span>(<span class="ruby-identifier">file_prefix</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">x</span> }
485:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">children_filenames</span><span class="method-args">(file_prefix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 473</span>
473:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_filenames</span> <span class="ruby-identifier">file_prefix</span>
474:     <span class="ruby-identifier">l</span> = []
475:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">mask?</span>
476:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
477:         <span class="ruby-identifier">l</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">child_filename_internal</span>(<span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child</span>)
478:       <span class="ruby-keyword kw">end</span>
479:     <span class="ruby-keyword kw">end</span>
480:     <span class="ruby-identifier">l</span>
481:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">children_have_been_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If this is true, we can run a meta-analysis (the second-stage
crossvalidation).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 283</span>
283:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_have_been_run?</span>
284:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">true</span>
285:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">false</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
286: 
287:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
288:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&amp;&amp;=</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">has_been_run?</span>
289:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>
290:     <span class="ruby-keyword kw">end</span>
291:     
292:     <span class="ruby-identifier">res</span>
293:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">columns</span><span class="method-args">(i = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get all <a href="Matrix.html#M000062">columns</a> or all <a
href="Matrix.html#M000062">columns</a> with row i
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 193</span>
193:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns</span>(<span class="ruby-identifier">i</span> = <span class="ruby-keyword kw">nil</span>)
194:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells_by_row_or_column</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">:j</span>, <span class="ruby-identifier">i</span>)
195:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="#M000055" class="method-signature">
          <span class="method-name">copy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Make a <a href="Matrix.html#M000055">copy</a> of the matrix (does not
include its children).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000055-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000055-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/matrix.rb, line 87</span>
87:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy</span>
88:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clone</span>
89:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; copy&quot;</span>
90:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
91:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">cell</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;matrix_id&quot;</span>})
92:     <span class="ruby-keyword kw">end</span>
93:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">empty_row</span><span class="ruby-operator">|</span>
94:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">empty_row</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;matrix_id&quot;</span>})
95:     <span class="ruby-keyword kw">end</span>
96:     <span class="ruby-identifier">matrix_copy</span>
97:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">copy_and_randomize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Note that this function only works for very sparse matrices. Once <a
href="Matrix.html#M000062">columns</a> start to be dense enough for lots of
collisions, this gets exponentially slower.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 124</span>
124:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_and_randomize</span>
125:     <span class="ruby-comment cmt"># Get the rows and columns</span>
126:     <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span>
127: 
128:     <span class="ruby-comment cmt"># Make an empty copy and to help it along give it the rows (one less db op)</span>
129:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_empty_copy</span> <span class="ruby-identifier">uqr</span>
130:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;r&quot;</span>
131:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">column_species</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;r&quot;</span>
132: 
133:     <span class="ruby-comment cmt"># Now we have to save the copy in order to do the randomization.</span>
134:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">save!</span>
135: 
136:     <span class="ruby-comment cmt"># Now go through and</span>
137:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_rows_by_column</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">col</span>, <span class="ruby-identifier">num</span><span class="ruby-operator">|</span>
138: 
139:       <span class="ruby-identifier">rand_column_contents</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
140:       <span class="ruby-comment cmt"># draw num from uqr for this column</span>
141:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">rand_column_contents</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">num</span>
142:         <span class="ruby-identifier">rand_column_contents</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">uqr</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">size</span>)]
143:       <span class="ruby-keyword kw">end</span>
144: 
145:       <span class="ruby-identifier">rand_column_contents</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
146:         <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">col</span>)
147:       <span class="ruby-keyword kw">end</span>
148:     <span class="ruby-keyword kw">end</span>
149: 
150:     <span class="ruby-comment cmt"># Now save the matrix copy and update the column count</span>
151:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">update_column_count!</span>
152:     <span class="ruby-identifier">matrix_copy</span>
153:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="#M000056" class="method-signature">
          <span class="method-name">copy_and_save</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000056-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000056-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy_and_save</span>
100:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clone</span>
101:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">save!</span>
102:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="#M000093" class="method-signature">
          <span class="method-name">count_unique_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000093-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000093-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 407</span>
407:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_columns</span>
408:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_column_sql</span>(<span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_i</span>
409:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <a href="#M000094" class="method-signature">
          <span class="method-name">count_unique_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000094-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000094-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 411</span>
411:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows</span>
412:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_row_sql</span>(<span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_i</span>
413:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000090" class="method-detail">
        <a name="M000090"></a>

        <div class="method-heading">
          <a href="#M000090" class="method-signature">
          <span class="method-name">count_unique_rows_by_column</span><span class="method-args">(which_j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000090-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000090-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 395</span>
395:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows_by_column</span>(<span class="ruby-identifier">which_j</span>)
396:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">which_j</span>, <span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>
397:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000092" class="method-detail">
        <a name="M000092"></a>

        <div class="method-heading">
          <a href="#M000092" class="method-signature">
          <span class="method-name">count_unique_rows_by_column</span><span class="method-args">(which_i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000092-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000092-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 403</span>
403:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">count_unique_rows_by_column</span>(<span class="ruby-identifier">which_i</span>)
404:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">which_i</span>, <span class="ruby-keyword kw">true</span>)).<span class="ruby-identifier">first</span>
405:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">density</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Gives a metric describing the number of cells in the matrix as a fraction
of the size &#8212; in terms of the number of cells per column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">density</span>
158:     <span class="ruby-identifier">cc</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_count</span>
159:     <span class="ruby-identifier">cc</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">column_count</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cc</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
160:     (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_unmasked_cells</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">cc</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>
161:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">dir_exists?</span><span class="method-args">(dir)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 549</span>
549:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dir_exists?</span> <span class="ruby-identifier">dir</span>
550:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">dir</span>)
551:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">fractalize</span><span class="method-args">(folds, methods, shuffle=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create n random subsets of this matrix, each of size (s * (n-1 / n)). If
supplied with a list, repeats recursively for each of the subsets. If
supplied with an integer, creates subsets which are of size (s / n), which
serve as masks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 503</span>
503:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fractalize</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>=<span class="ruby-keyword kw">true</span>)
504: 
505:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
506:       <span class="ruby-identifier">fold</span>    = <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">shift</span>
507:       <span class="ruby-identifier">meth</span>    = <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">shift</span>
508: 
509:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;fold is #{fold}, meth is #{meth}&quot;</span>)
510:       
511:       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;folds and methods must be the same size&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">size</span>
512: 
513:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">folds</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span>
514:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">fractalize_internal</span>(<span class="ruby-identifier">fold</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>)
515:         <span class="ruby-comment cmt"># recurse</span>
516:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
517:           <span class="ruby-identifier">child</span>.<span class="ruby-identifier">fractalize</span>(<span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>)
518:         <span class="ruby-keyword kw">end</span>
519:       <span class="ruby-keyword kw">else</span>
520:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mask_fractalize_internal</span> <span class="ruby-identifier">fold</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>
521:       <span class="ruby-keyword kw">end</span>
522:     <span class="ruby-keyword kw">else</span>
523:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mask_fractalize_internal</span> <span class="ruby-identifier">folds</span>, <span class="ruby-identifier">methods</span>, <span class="ruby-identifier">shuffle</span>
524:     <span class="ruby-keyword kw">end</span>
525:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">has_been_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if all experiments have been run for a matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 296</span>
296:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_been_run?</span>
297:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">true</span>
298:     <span class="ruby-identifier">res</span> = <span class="ruby-keyword kw">false</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
299: 
300:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">experiment</span><span class="ruby-operator">|</span>
301:       <span class="ruby-identifier">res</span> <span class="ruby-operator">&amp;&amp;=</span> <span class="ruby-identifier">experiment</span>.<span class="ruby-identifier">has_been_run?</span>
302:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">res</span>
303:     <span class="ruby-keyword kw">end</span>
304: 
305:     <span class="ruby-identifier">res</span>
306:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">has_experiments_to_run?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 487</span>
487:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_experiments_to_run?</span>
488:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">experiments</span>.<span class="ruby-identifier">not_run</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
489:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000098" class="method-detail">
        <a name="M000098"></a>

        <div class="method-heading">
          <a href="#M000098" class="method-signature">
          <span class="method-name">is_phenomatrix?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Depends on entry_infos &#8212; genes and phenotypes as the row and column
titles indicate phenomatrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000098-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000098-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 446</span>
446:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_phenomatrix?</span>
447:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">row_title</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;gene&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">column_title</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;phenotype&quot;</span>
448:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">list_children</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 527</span>
527:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_children</span>
528:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">id</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
529:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">make_empty_copy</span><span class="method-args">(uqr = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 104</span>
104:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_empty_copy</span> <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">nil</span>
105:     <span class="ruby-identifier">matrix_copy</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clone</span>
106:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">title</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; copy&quot;</span>
107: 
108: 
109:     <span class="ruby-comment cmt"># Get the rows and columns</span>
110:     <span class="ruby-identifier">uqr</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">nil?</span>
111: 
112:     <span class="ruby-comment cmt"># First create empty rows</span>
113:     <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
114:       <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span>)
115:     <span class="ruby-keyword kw">end</span>
116:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">row_count</span>    = <span class="ruby-identifier">uqr</span>.<span class="ruby-identifier">size</span>
117:     <span class="ruby-identifier">matrix_copy</span>.<span class="ruby-identifier">column_count</span> = <span class="ruby-value">0</span>
118:     <span class="ruby-identifier">matrix_copy</span>
119:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">make_inputs</span><span class="method-args">(rows_filename, cells_filename, file_prefix = &quot;testset&quot;, dest_dir = self.root)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generate two files in the current directory, one containing the row
indeces, the other containing the cells in the matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 533</span>
533:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_inputs</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>, <span class="ruby-identifier">file_prefix</span> = <span class="ruby-value str">&quot;testset&quot;</span>, <span class="ruby-identifier">dest_dir</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>
534:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dest_dir</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">dest_dir</span>)
535:     <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">dest_dir</span>) <span class="ruby-keyword kw">do</span>
536:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_inputs_internal</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>
537:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_children_if_masks</span> <span class="ruby-identifier">file_prefix</span>
538:     <span class="ruby-keyword kw">end</span>
539:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">mask?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If this is a submatrix, does it mask another matrix? Only the leaf matrices
are masks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 277</span>
277:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mask?</span>
278:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
279:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">number_of_empty_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 259</span>
259:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_empty_rows</span>
260:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>
261:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">count</span>
262:     <span class="ruby-keyword kw">else</span>
263:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">number_of_empty_rows</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">count</span>
264:     <span class="ruby-keyword kw">end</span>
265:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">number_of_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 267</span>
267:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_rows</span>
268:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>
269:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_count</span>
270:     <span class="ruby-keyword kw">else</span>
271:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">row_count</span>
272:     <span class="ruby-keyword kw">end</span>
273:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">number_of_rows_by_column</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get a hash of the column identifiers to the number of <a
href="Matrix.html#M000063">rows</a> that have non-zero values in that
column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 165</span>
165:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_rows_by_column</span>
166:     <span class="ruby-identifier">num_rows_by_column</span> = {}
167:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_rows</span>(<span class="ruby-value str">&quot;SELECT j, COUNT(DISTINCT entries.i) AS count_i FROM matrices\nINNER JOIN entries ON (entries.matrix_id = matrices.id)\nWHERE entries.type = 'Cell' AND matrices.id = \#{self.id} GROUP BY j\n&quot;</span>
168:     ).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
169:       <span class="ruby-identifier">num_rows_by_column</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>] = <span class="ruby-identifier">row</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
170:     <span class="ruby-keyword kw">end</span>
171:     <span class="ruby-identifier">num_rows_by_column</span>
172:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">number_of_unmasked_cells</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 251</span>
251:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">number_of_unmasked_cells</span>
252:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mask?</span>
253:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">count</span>
254:     <span class="ruby-keyword kw">else</span>
255:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">count</span>
256:     <span class="ruby-keyword kw">end</span>
257:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">prepare_inputs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Prepare working directory for the matrix
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_inputs</span>
224:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_inputs</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_filename</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cell_filename</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root_exists?</span>
225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000082" class="method-detail">
        <a name="M000082"></a>

        <div class="method-heading">
          <a href="#M000082" class="method-signature">
          <span class="method-name">read_entries_from_file!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Given a file stream or filename, read into this matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000082-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000082-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 366</span>
366:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_entries_from_file!</span>(<span class="ruby-identifier">file</span>)
367:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Pathname</span>)
368:       <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;r&quot;</span>))
369:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">File</span>)
370:       <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-identifier">file</span>)
371:     <span class="ruby-keyword kw">else</span>
372:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Expected filename or file as argument&quot;</span>
373:       <span class="ruby-keyword kw">false</span>
374:     <span class="ruby-keyword kw">end</span>
375:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 545</span>
545:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root</span>
546:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">work_root</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;matrix_#{self.id}&quot;</span>
547:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">root_exists?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 553</span>
553:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root_exists?</span>
554:     <span class="ruby-identifier">dir_exists?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>)
555:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">row_distribution</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Order the <a href="Matrix.html#M000062">columns</a> by the number of <a
href="Matrix.html#M000063">rows</a> and build as a list of lists, for
plotting with flotomatic.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 182</span>
182:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_distribution</span>
183:     <span class="ruby-identifier">num_rows_by_col</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">number_of_rows_by_column</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">sort</span>
184:     <span class="ruby-identifier">num_rows_by_col</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
185:       <span class="ruby-identifier">val</span> = <span class="ruby-identifier">num_rows_by_col</span>[<span class="ruby-identifier">i</span>]
186:       <span class="ruby-identifier">num_rows_by_col</span>[<span class="ruby-identifier">i</span>] = [<span class="ruby-identifier">i</span>, <span class="ruby-identifier">val</span>]
187:     <span class="ruby-keyword kw">end</span>
188:     <span class="ruby-identifier">num_rows_by_col</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">row_file_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_file_path</span>
232:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_filename</span>
233:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">row_filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 227</span>
227:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">row_filename</span>
228:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info</span>.<span class="ruby-identifier">row_filename</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_species</span>)
229:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">rows</span><span class="method-args">(j = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get all <a href="Matrix.html#M000063">rows</a> or all those with column j
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rows</span>(<span class="ruby-identifier">j</span> = <span class="ruby-keyword kw">nil</span>)
199:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells_by_row_or_column</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">:i</span>, <span class="ruby-identifier">j</span>)
200:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">stages</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the number of <a href="Matrix.html#M000105">stages</a> of
cross-validation this matrix is set up for.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 493</span>
493:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stages</span>
494:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
495:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">stages</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># recursive.</span>
496:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <span class="method-name">uniq_cols</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000085">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <span class="method-name">uniq_columns</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000085">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <span class="method-name">uniq_rows</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000083">unique_rows</a>
</p>
        </div>
      </div>

      <div id="method-M000088" class="method-detail">
        <a name="M000088"></a>

        <div class="method-heading">
          <span class="method-name">unique_cols</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Matrix.html#M000085">unique_columns</a>
</p>
        </div>
      </div>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="#M000085" class="method-signature">
          <span class="method-name">unique_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get unique <a href="Matrix.html#M000062">columns</a> in the matrix
(identical to <a href="Matrix.html#M000083">unique_rows</a>, but <a
href="Matrix.html#M000062">columns</a> instead).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000085-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000085-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 384</span>
384:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_columns</span>
385:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_column_sql</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
386:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000091" class="method-detail">
        <a name="M000091"></a>

        <div class="method-heading">
          <a href="#M000091" class="method-signature">
          <span class="method-name">unique_columns_by_row</span><span class="method-args">(which_i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000091-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000091-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 399</span>
399:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_columns_by_row</span>(<span class="ruby-identifier">which_i</span>)
400:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:j</span>, <span class="ruby-identifier">which_i</span>)).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
401:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">unique_descriptor</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A descriptor which uniquely identifies a matrix, useful for drop-down boxes
particularly when title is the same for multiple matrices. In this case,
it&#8216;s the ID and the title.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/matrix.rb, line 81</span>
81:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_descriptor</span>
82:     <span class="ruby-node">&quot;#{self.id}: #{self.title}&quot;</span>
83:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000083" class="method-detail">
        <a name="M000083"></a>

        <div class="method-heading">
          <a href="#M000083" class="method-signature">
          <span class="method-name">unique_rows</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get a list of unique <a href="Matrix.html#M000063">rows</a> in the matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000083-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000083-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 378</span>
378:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_rows</span>
379:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_row_sql</span>).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
380:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000089" class="method-detail">
        <a name="M000089"></a>

        <div class="method-heading">
          <a href="#M000089" class="method-signature">
          <span class="method-name">unique_rows_by_column</span><span class="method-args">(which_j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000089-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000089-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 391</span>
391:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_rows_by_column</span>(<span class="ruby-identifier">which_j</span>)
392:     <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">:i</span>, <span class="ruby-identifier">which_j</span>)).<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">to_i</span> }
393:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000097" class="method-detail">
        <a name="M000097"></a>

        <div class="method-heading">
          <a href="#M000097" class="method-signature">
          <span class="method-name">write</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write a single matrix, not its children.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000097-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000097-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 434</span>
434:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
435:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
436:     
437:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
438:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;Sorry, you need to save the matrix before trying to write its contents. Call write! instead if you want to force a save.&quot;</span>
439:     <span class="ruby-keyword kw">else</span>
440:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">opts</span>)
441:     <span class="ruby-keyword kw">end</span>
442:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="#M000099" class="method-signature">
          <span class="method-name">write!</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Force a save before writing; otherwise, same as <a
href="Matrix.html#M000097">write</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000099-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000099-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 451</span>
451:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write!</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
452:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
453:     
454:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
455:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">opts</span>)
456:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000100" class="method-detail">
        <a name="M000100"></a>

        <div class="method-heading">
          <a href="#M000100" class="method-signature">
          <span class="method-name">write_children_if_masks</span><span class="method-args">(file_prefix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000100-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000100-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 458</span>
458:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_children_if_masks</span> <span class="ruby-identifier">file_prefix</span>
459:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">mask?</span>
460:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
461:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">root</span>) <span class="ruby-keyword kw">do</span>
462:           <span class="ruby-identifier">child</span>.<span class="ruby-identifier">write</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">child_filename_internal</span>(<span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child</span>), <span class="ruby-identifier">:force_not_masked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> )
463:         <span class="ruby-keyword kw">end</span>
464:       <span class="ruby-keyword kw">end</span>
465:     <span class="ruby-keyword kw">end</span>
466:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000096" class="method-detail">
        <a name="M000096"></a>

        <div class="method-heading">
          <a href="#M000096" class="method-signature">
          <span class="method-name">write_rows</span><span class="method-args">(file, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write a single matrix&#8216;s row indeces.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000096-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000096-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 423</span>
423:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_rows</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {})
424:     <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span>
425:     
426:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
427:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;Sorry, you need to save the matrix before trying to write its contents. Call write_rows! instead if you want to force a save.&quot;</span>
428:     <span class="ruby-keyword kw">else</span>
429:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved_rows</span>(<span class="ruby-identifier">file</span>)
430:     <span class="ruby-keyword kw">end</span>
431:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="#M000095" class="method-signature">
          <span class="method-name">write_rows!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write all row indeces to a file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000095-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000095-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 417</span>
417:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_rows!</span>(<span class="ruby-identifier">file</span>)
418:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changed?</span>
419:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_saved_rows</span>(<span class="ruby-identifier">file</span>)
420:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">build_submatrices!</span><span class="method-args">(num)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 758</span>
758:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build_submatrices!</span> <span class="ruby-identifier">num</span>
759:     (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">num</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
760:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:cardinality</span>  =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">n</span>,
761:         <span class="ruby-identifier">:title</span>          =<span class="ruby-operator">&gt;</span>   <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">make_submatrix_title</span>(<span class="ruby-identifier">n</span>,<span class="ruby-identifier">num</span>),
762:         <span class="ruby-identifier">:entry_info_id</span>  =<span class="ruby-operator">&gt;</span>   <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">entry_info_id</span>        )
763:     <span class="ruby-keyword kw">end</span>
764:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000128" class="method-detail">
        <a name="M000128"></a>

        <div class="method-heading">
          <a href="#M000128" class="method-signature">
          <span class="method-name">cells_by_row</span><span class="method-args">(i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000128-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000128-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 749</span>
749:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_by_row</span> <span class="ruby-identifier">i</span>
750:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>})
751:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">cells_for_display_as_masked</span><span class="method-args">(res = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 814</span>
814:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_for_display_as_masked</span>(<span class="ruby-identifier">res</span> = {})
815:     <span class="ruby-identifier">parent_cells</span>   = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">cells</span>
816:     <span class="ruby-identifier">child_cells</span>    = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>
817:     <span class="ruby-identifier">unmasked_cells</span> = <span class="ruby-identifier">parent_cells</span>    <span class="ruby-operator">-</span>    <span class="ruby-identifier">child_cells</span>
818: 
819:     <span class="ruby-identifier">unmasked_cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
820:       <span class="ruby-identifier">res</span>[<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value str">&quot;:&quot;</span>)] = <span class="ruby-constant">CellValue</span>.<span class="ruby-identifier">new</span>
821:     <span class="ruby-keyword kw">end</span>
822:     <span class="ruby-identifier">child_cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
823:       <span class="ruby-identifier">res</span>[<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value str">&quot;:&quot;</span>)] = <span class="ruby-constant">CellValue</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">true</span>) <span class="ruby-comment cmt"># masked</span>
824:     <span class="ruby-keyword kw">end</span>
825: 
826:     <span class="ruby-identifier">res</span>
827:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">cells_for_display_as_not_masked</span><span class="method-args">(res = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 829</span>
829:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cells_for_display_as_not_masked</span>(<span class="ruby-identifier">res</span> = {})
830:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
831:       <span class="ruby-identifier">res</span>[<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value str">&quot;:&quot;</span>)] = <span class="ruby-constant">CellValue</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">false</span>)
832:     <span class="ruby-keyword kw">end</span>
833: 
834:     <span class="ruby-identifier">res</span>
835:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="#M000115" class="method-signature">
          <span class="method-name">child_filename_internal</span><span class="method-args">(file_prefix, child_matrix)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000115-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 585</span>
585:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child_filename_internal</span> <span class="ruby-identifier">file_prefix</span>, <span class="ruby-identifier">child_matrix</span>
586:     <span class="ruby-node">&quot;#{file_prefix}.#{self.children.count.to_s}-#{child_matrix.cardinality}&quot;</span>
587:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">create_empty_row!</span><span class="method-args">(i)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 770</span>
770:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_empty_row!</span>(<span class="ruby-identifier">i</span>)
771:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty_rows</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">i</span>)
772:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">find_or_create_cell!</span><span class="method-args">(i, j)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 766</span>
766:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">j</span>)
767:     <span class="ruby-constant">Cell</span>.<span class="ruby-identifier">find_or_create!</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">j</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>)
768:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000127" class="method-detail">
        <a name="M000127"></a>

        <div class="method-heading">
          <a href="#M000127" class="method-signature">
          <span class="method-name">fractalize_internal</span><span class="method-args">(fold, meth, shuffle)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns n new matrices, each with (s * (n - 1) / n) items. Empty <a
href="Matrix.html#M000063">rows</a> are copied into child matrices. If
deletion of cells creates new empty <a href="Matrix.html#M000063">rows</a>,
those are created in the child as well.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000127-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000127-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 721</span>
721:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fractalize_internal</span> <span class="ruby-identifier">fold</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>
722:     <span class="ruby-comment cmt"># self.divisions = fold</span>
723: 
724:     <span class="ruby-identifier">divs</span>     = <span class="ruby-identifier">split_set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_to_fractalize</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>), <span class="ruby-identifier">fold</span>)
725:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_submatrices!</span> <span class="ruby-identifier">fold</span>
726: 
727:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:cell</span>
728:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">fold</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
729:         <span class="ruby-comment cmt"># Get the union of all but one of the divisions.</span>
730:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;cell union count is #{divs[n].size}&quot;</span>
731:         <span class="ruby-identifier">combine_all_but_one</span>(<span class="ruby-identifier">divs</span>, <span class="ruby-identifier">n</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
732:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">i</span>, <span class="ruby-identifier">:j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">j</span>)
733:         <span class="ruby-keyword kw">end</span>
734:       <span class="ruby-keyword kw">end</span>
735:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:row</span>
736:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">fold</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
737:         <span class="ruby-comment cmt"># Link masking cells to each matrix.</span>
738:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;row union count is #{divs[n].size}&quot;</span>
739:         <span class="ruby-identifier">combine_all_but_one</span>(<span class="ruby-identifier">divs</span>, <span class="ruby-identifier">n</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
740:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells_by_row</span>(<span class="ruby-identifier">row</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">i</span>, <span class="ruby-identifier">:j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">j</span>) }
741:         <span class="ruby-keyword kw">end</span>
742:       <span class="ruby-keyword kw">end</span>
743:     <span class="ruby-keyword kw">end</span>
744: 
745:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>
746:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="#M000116" class="method-signature">
          <span class="method-name">make_inputs_internal</span><span class="method-args">(rows_filename, cells_filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000116-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 589</span>
589:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_inputs_internal</span> <span class="ruby-identifier">rows_filename</span>, <span class="ruby-identifier">cells_filename</span>
590:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_rows</span>(<span class="ruby-identifier">rows_filename</span>)
591:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">cells_filename</span>)
592:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000129" class="method-detail">
        <a name="M000129"></a>

        <div class="method-heading">
          <a href="#M000129" class="method-signature">
          <span class="method-name">make_submatrix_title</span><span class="method-args">(n, total)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000129-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000129-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 754</span>
754:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">make_submatrix_title</span> <span class="ruby-identifier">n</span>, <span class="ruby-identifier">total</span>
755:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">title</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; (&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">n</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">total</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;)&quot;</span>
756:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">mask_fractalize_internal</span><span class="method-args">(fold, meth, shuffle)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Fractalize but build masks of this matrix (the parent) instead of building
whole matrices. This function doesn&#8216;t mess with empty row entries,
only cell entries.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 688</span>
688:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mask_fractalize_internal</span> <span class="ruby-identifier">fold</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>
689:     <span class="ruby-comment cmt"># self.divisions = fold</span>
690:     
691:     <span class="ruby-identifier">divs</span>     = <span class="ruby-identifier">split_set</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_to_fractalize</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>), <span class="ruby-identifier">fold</span>)
692:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build_submatrices!</span> <span class="ruby-identifier">fold</span>
693: 
694:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:cell</span>
695:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">fold</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
696:         <span class="ruby-comment cmt"># Link masking cells to each matrix.</span>
697:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;cell div count is #{divs[n].size}&quot;</span>
698:         <span class="ruby-identifier">divs</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
699:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">i</span>, <span class="ruby-identifier">:j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">j</span>)
700:         <span class="ruby-keyword kw">end</span>
701:       <span class="ruby-keyword kw">end</span>
702:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:row</span>
703:       (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">fold</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
704:         <span class="ruby-comment cmt"># Link masking cells to each matrix.</span>
705:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;row div count is #{divs[n].size}&quot;</span>
706:         <span class="ruby-identifier">divs</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
707:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells_by_row</span>(<span class="ruby-identifier">row</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
708:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>[<span class="ruby-identifier">n</span>].<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:i</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">i</span>, <span class="ruby-identifier">:j</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cell</span>.<span class="ruby-identifier">j</span>)
709:           <span class="ruby-keyword kw">end</span>
710:         <span class="ruby-keyword kw">end</span>
711:       <span class="ruby-keyword kw">end</span>
712:     <span class="ruby-keyword kw">end</span>
713: 
714:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span>
715:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">read_entries_from_open_file!</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Read a list of cells or <a href="Matrix.html#M000063">rows</a>. If a single
entry in a line, it&#8216;s an empty row (meaning no cells in that row). If
two entries, it&#8216;s a cell with a true value in it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 796</span>
796:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_entries_from_open_file!</span>(<span class="ruby-identifier">file</span>)
797:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">line</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">gets</span>
798:       <span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp!</span>
799:       <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\t&quot;</span>)
800: 
801:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># List of rows.</span>
802:         <span class="ruby-comment cmt"># Create a row.</span>
803:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_empty_row!</span>(<span class="ruby-identifier">fields</span>[<span class="ruby-value">0</span>])
804:       <span class="ruby-keyword kw">else</span>
805:         <span class="ruby-comment cmt"># Convert a row to a cell (or just create a cell).</span>
806:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_or_create_cell!</span>(<span class="ruby-identifier">fields</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">fields</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>)
807:       <span class="ruby-keyword kw">end</span>
808:     <span class="ruby-keyword kw">end</span>
809: 
810:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_column_count!</span>
811:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_row_count!</span>
812:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">set_to_fractalize</span><span class="method-args">(meth, shuffle)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Get the set of cells or <a href="Matrix.html#M000063">rows</a> to <a
href="Matrix.html#M000106">fractalize</a>. Called only by <a
href="Matrix.html#M000126">mask_fractalize_internal</a> and <a
href="Matrix.html#M000127">fractalize_internal</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 670</span>
670:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_to_fractalize</span> <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">shuffle</span>
671:     <span class="ruby-identifier">my_set</span> = <span class="ruby-keyword kw">nil</span>
672:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:cell</span>
673:       <span class="ruby-identifier">my_set</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">dup</span>
674:       <span class="ruby-identifier">my_set</span>.<span class="ruby-identifier">shuffle!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">shuffle</span>
675:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">meth</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:row</span>
676:       <span class="ruby-identifier">my_set</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rows</span>
677:       <span class="ruby-identifier">my_set</span>.<span class="ruby-identifier">shuffle!</span>
678:     <span class="ruby-keyword kw">else</span>
679:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;method #{meth} not recognized&quot;</span>
680:     <span class="ruby-keyword kw">end</span>
681:     <span class="ruby-identifier">my_set</span>
682:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">unique_column_sql</span><span class="method-args">(count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 598</span>
598:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_column_sql</span>(<span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
599:     <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-value str">&quot;j&quot;</span>, <span class="ruby-identifier">count</span>)
600:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">unique_entry_value_sql</span><span class="method-args">(field, count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used for returning either row or column of every entry corresponding to
this matrix.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 559</span>
559:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
560:     <span class="ruby-identifier">sql</span> = <span class="ruby-value str">&quot;SELECT &quot;</span>
561:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">count</span>
562:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;COUNT(DISTINCT #{Entry.table_name}.#{field}) &quot;</span>
563:     <span class="ruby-keyword kw">else</span>
564:       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;DISTINCT #{Entry.table_name}.#{field} &quot;</span>
565:     <span class="ruby-keyword kw">end</span>
566:     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;FROM \#{Matrix.table_name}\nINNER JOIN \#{Entry.table_name} ON (\#{Entry.table_name}.matrix_id = \#{Matrix.table_name}.id)\nWHERE \#{Matrix.table_name}.id = \#{self.id}\n&quot;</span>
567:     <span class="ruby-identifier">sql</span>
568:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">unique_row_sql</span><span class="method-args">(count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 594</span>
594:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_row_sql</span>(<span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
595:     <span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-value str">&quot;i&quot;</span>, <span class="ruby-identifier">count</span>)
596:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="#M000114" class="method-signature">
          <span class="method-name">unique_vector_sql</span><span class="method-args">(field, at, count = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000114-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 576</span>
576:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unique_vector_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">at</span>, <span class="ruby-identifier">count</span> = <span class="ruby-keyword kw">false</span>)
577:     <span class="ruby-identifier">vf</span> = <span class="ruby-identifier">field</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;i&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;j&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;i&quot;</span>
578:     <span class="ruby-identifier">sql</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_entry_value_sql</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">count</span>)
579:     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; AND #{Entry.table_name}.#{vf} = #{at}&quot;</span>
580:     <span class="ruby-identifier">sql</span>
581:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">update_column_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 783</span>
783:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_column_count</span>
784:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">column_count</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">count_unique_columns</span>
785:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">update_column_count!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 787</span>
787:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_column_count!</span>
788:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_column_count</span>
789:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
790:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">update_row_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 774</span>
774:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_row_count</span>
775:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">row_count</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">count_unique_rows</span>
776:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">update_row_count!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 778</span>
778:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_row_count!</span>
779:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_row_count</span>
780:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
781:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">write_as_masked</span><span class="method-args">(open_file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
When writing, treat this matrix as a mask of the parent &#8212; in other
words, print the parent&#8216;s cells less the cells found in this child.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 635</span>
635:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_as_masked</span>(<span class="ruby-identifier">open_file</span>)
636:     <span class="ruby-identifier">parent_cells</span> = <span class="ruby-constant">Matrix</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent_id</span>).<span class="ruby-identifier">cells</span>
637:     <span class="ruby-identifier">my_cells</span>     = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>
638: 
639:     <span class="ruby-comment cmt"># Subtract the mask from the parent cells and we get the remainder,</span>
640:     <span class="ruby-comment cmt"># which we want to print.</span>
641:     (<span class="ruby-identifier">parent_cells</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">my_cells</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
642:       <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">open_file</span>)
643:     <span class="ruby-keyword kw">end</span>
644: 
645:     <span class="ruby-identifier">open_file</span>
646:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">write_as_not_masked</span><span class="method-args">(open_file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Print the stuff in this matrix whether or not it&#8216;s a mask of a
parent.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 649</span>
649:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_as_not_masked</span>(<span class="ruby-identifier">open_file</span>)
650:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cells</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
651:       <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">open_file</span>)
652:     <span class="ruby-keyword kw">end</span>
653:     <span class="ruby-identifier">open_file</span>
654:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">write_contents</span><span class="method-args">(open_file, options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Write the contents of the matrix, keeping in mind that it may be a mask or
the full matrix. This should really never be called externally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 658</span>
658:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_contents</span>(<span class="ruby-identifier">open_file</span>, <span class="ruby-identifier">options</span>)
659:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">mask?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force_not_masked</span>]
660:       <span class="ruby-identifier">write_as_masked</span>(<span class="ruby-identifier">open_file</span>)      <span class="ruby-comment cmt"># Complex case.</span>
661:     <span class="ruby-keyword kw">else</span>
662:       <span class="ruby-identifier">write_as_not_masked</span>(<span class="ruby-identifier">open_file</span>)  <span class="ruby-comment cmt"># Simple case.</span>
663:     <span class="ruby-keyword kw">end</span>
664:     
665:     <span class="ruby-identifier">open_file</span>
666:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">write_options</span><span class="method-args">(options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the default options for <a href="Matrix.html#M000097">write</a>()
and the functions it calls.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 604</span>
604:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_options</span> <span class="ruby-identifier">options</span> = {}
605:     {
606:       <span class="ruby-identifier">:header</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
607:       <span class="ruby-identifier">:force_not_masked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
608:     }.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">options</span>
609:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">write_saved</span><span class="method-args">(file, options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Use this to force writing of a matrix that has already been saved. It may
work with an unsaved file, but behavior could be unpredictable and it would
likely be a bad idea.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 619</span>
619:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_saved</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span>)
620:     
621:     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">file</span>
622:     <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Pathname</span>)
623: 
624:     <span class="ruby-comment cmt"># write the header</span>
625:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">matrix_info</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:header</span>]
626: 
627:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">write_contents</span>(<span class="ruby-identifier">f</span>, <span class="ruby-identifier">options</span>)
628: 
629:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
630:     <span class="ruby-identifier">f</span>.<span class="ruby-identifier">path</span>
631:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">write_saved_rows</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
See <a href="Matrix.html#M000121">write_saved</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/matrix.rb, line 612</span>
612:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_saved_rows</span> <span class="ruby-identifier">file</span>
613:     <span class="ruby-identifier">writelines</span>(<span class="ruby-identifier">file</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">unique_rows</span>)
614:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>